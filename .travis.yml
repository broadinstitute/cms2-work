sudo: required

dist: focal
os: linux

git:
#  depth: 5
  submodules: false

services:
  - docker

env:
#  - LANGUAGE=cwl
  global:
    - LANGUAGE=wdl
    # GH_TOKEN
    - secure: "It3NFjyFxrWV4giAI3Ai9GbiMtK35MbZM5Fnf9qGHXlYOO4VL9u/0CXICyf7Wo0mi5nl5DjBPdE/MoDNaudKMqDpPoZNTc7+yOJJNOMrl+NGNOu8QADNNYK/y6WrJRkV/AzXcFnQOOFbOm18EIkvEFGnvYgg1jFNvD6auqZrZImXMB1SimwerfcyIUymxiWBNA32+Sr+4rpeFHVnKIlM6n2Be3SXZ5KCpHW/RV+oyyjTpRutq3k4RIPNYinwNmg8G2kHdGDzbMjD5S03cLAzQq7+F3M+1AnrvT8xZOGZmoQGWAJw2BMm5pDbQAufaotO2W6N68CVo2FCnCrHYs82lovmF6aEq0Qed2wmmupd8pXpVBCdhpYBu4M6tOjbaT4FsPyC7EtkC5a/ft63htge5NNs3ikao4vezADdtDn9z4eFgUDi45HaRom9rTEi1ePLHa1ryhICU63+T1nKBOenYzQ/en7kRwir1yljDUiOQ+/fLr25uS0c2F9X4J8GCoVRQCV4jhMAq8Qjt0nvvogYE9OEMrbD4FT9SDc5+VprCPjfSY1PK9WRskW1rb5/7jD2iRA8u1PJ8yk2mOebt6HwvRmhkgiZzOFBgZNELn9kJSmQcx3M2eCLIZRHfCuYztP+6xZn4vRi10MVxwHMoVUWpyCCrPmG4aVnAJZIcET91uA="

branches:
  except:
    - /.*-staging$/
    - /^staging-.*/

stages:
  - main

branches:
  except:
    - is-branch-info

jobs:
  fast_finish: true
  include:
    
    - language: python
      stage: main
      python: "3.8"
      before_install:
        - openssl aes-256-cbc -K $encrypted_cd0220f97c1a_key -iv $encrypted_cd0220f97c1a_iv -in terra/gcloud-config.tar.gz.enc -out terra/gcloud-config.tar.gz -d
        - sudo apt-get update
        - sudo apt-get -y install openjdk-8-jre-headless
      install:
#        - pip3 -q install miniwdl
        - pip3 -q install firecloud
      script:
        - set -e
        - ./travis/test-wdl.sh
        - tar -xzf terra/gcloud-config.tar.gz -C $HOME
        - ./terra/terra_utils.py cmd_with_filename -f myfile.txt
        - ./terra/terra_utils.py deploy_to_terra



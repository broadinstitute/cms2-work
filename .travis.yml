sudo: required

dist: focal
os: linux

git:
#  depth: 5
  submodules: false

services:
  - docker

env:
#  - LANGUAGE=cwl
  global:
    - PYTHONIOENCODING=UTF8
    - LANGUAGE=wdl
    # GH_TOKEN
    - secure: "TZgdT3wn1oJ8TJhlTBI1kZ65/MxHRViHiQj9sqDZuGJrp3D86Kb7LZsa6VxQz4GIeqAWZASBKJLD7K5x52VEzJpW80VkrTN7gh4DpCb/VaG2ymNiF9P1TP0AEVeXzdyaQ2ZyaKTDaDTwSA3yRHGSiJSlm2bPfKYT87O+d1YtvShfKmMecBN7U6ph8hqch9y79KAmGjsquX/VN61F+TIhMzu8OrQ6j1Hcu3MX/wWLA71vXO6QrwIHS1mz2nQfCkQVGJQ2gymlE2ppop17j9aIdcBn2K5gpW737bWMMh5Ki5ckWvoSFkxySryZ+ylkfmPOPWBE/FZc0kX4qJ3GCTE5PkEgosbRF723u82xaYLplQQClQwLhfmwhzS8+4AXol20tjDaXma5koV+C3HJq3icvZytBfnJoSi6KDLgXbl/pxddJ4+XR7NDpbB64NT28RMmAwFyTYSzFiacFtRMusE8BtLNosWrjfCdmKm03fOMpK00y4mLiQGBApRJ4gfadDiYdVnYNnfrjryLdc/pMPdF1RBXuBBObG6XxwrwE4nRpTbOJO8Ee/szt8f1TbXR/sHdeDn/Yi/71XlqJdG/vmRmU/5Ew9MX+BkiYK/+cCzLz++G2GvIP1gox2IykKz/9t+rk77i/KIcAdJjAg3Bq3vtkuXSPd2GWRf22hND9tOw0EQ="
    # QUAY_CMS_TOKEN
    - secure: "GyEqpqHlyDbPlow7t9BrJzZMGclVw/Rh5l6lrAqvhj4A5bZ+xw0fSxC5q1V9fQ4Rp04pyoi5Y5MzzorPViA/4pkEXKxzDdo+pwqoHCTqHmF5pTzDjyK1LSldcZELHIMkX0zveN6GTPBep/PnNVr12lEp4SvMj01FVRzPbEzfXAGU8Izkzy6Msi+97KE9CzMp9iDKUkB4H7wnuTGexMCyH/og9/cNKMWuB3GlLM2bY9O3v7v9cNv6robLc0d8V3Mb/5jKIT37+RDn+jj95FAwTjYs8Th1fgh6Uiin4Xjxr9T39td02QRHa29QHWNm5Exc0MEVFEPaglXEGpt5rOF7Vj9byL0k4R4vsixYa1IldTGor0NL+1EH5c+JiPjtQzMrifId/5LUeZE8SBsphKlhXpc/ldXt7Kj/f8+NnUjWPmipwlfi2zKqLQ+m4VBmKDJUnZhAPPmDLo3JAtXa7nqpTVE3lMtqiDck0bUCw0lo+glac0l4Xt6ctfWZd/tl6AbNWwCGXEUPNOg3ftyUdkAjNzxes9kwE/RpviiL66obYH3ILSzlGNLTsPNjSuPcPcLC9s8VChMOQNNGOmWcwkJBQYDRnQCq1D1jU/qBqBfKKgKrU/EsVXpewzDSOtonEhXpL3O3athxGAPBmdWwe0eh71GqPN5vRI96svH3X8ICS64="

branches:
  except:
    - /.*-staging$/
    - /^staging-.*/

stages:
  - main

branches:
  except:
    - is-branch-info

jobs:
  fast_finish: true
  include:
    
    - language: python
      stage: main
      python: "3.8"
      before_install:
        - openssl aes-256-cbc -K $encrypted_cd0220f97c1a_key -iv $encrypted_cd0220f97c1a_iv -in terra/gcloud-config.tar.gz.enc -out terra/gcloud-config.tar.gz -d
        - sudo apt-get update || true
        - sudo apt-get -y install openjdk-8-jre-headless
      install:
        - pip3 -q install firecloud PyYAML
      script:
        - set -e
        - ./travis/test-wdl.sh
        - tar -xzf terra/gcloud-config.tar.gz -C $HOME
        - ./terra/terra_utils.py deploy_to_terra

sudo: required

dist: focal
os: linux

git:
#  depth: 5
  submodules: false

services:
  - docker

env:
#  - LANGUAGE=cwl
  global:
    - LANGUAGE=wdl
    # GH_TOKEN
    - secure: "V0pLOrVC1vfMh2+UYPVMbAVrcwnUpiw/ceJVgGpUSWip0oHtnDX3aTYI1q/AghM1bqwskq1AHcCRhLAVnLXgCktgGR/q4rdReRqlcEK5Z5fsDOyI7lGuHaTxXZpAw1HhKLK3jQ0tUq6wSVEk7m9gbpoDZAzRIYc8UueOi3EgJvDHkVQCQeDWq6lDsIIhsnkXy5fsmbFlU2vQdkPELQRYbhM5sYQepD9nvJOHHgWRgzWjmrBAUcvh9FLlYrOw/AKrdPbNruUAFbEjvMfULfA64sVf476TEsa5YVZuQ1Fr9PoEZDynt/6/AG3IAt6kmXFGdn5Hx0oL/RRx4lBtAKxUsuBWzpBni1pM8/IS13w4pTHhc+6AzPw1P+vKwhuzKG6bSo6xRiBkEiKY37UrzJIvb54s0Zv9aF/azPhyEBCLi0lRamSSXDbY+uAWBlL5n7dk7FzZi+30K3437sKt00rsEsP8mmH5tvuiSooVEbuAzxq034wBc6WflypzDg3o7s5Tb9Pfdm+XmaTc3EhjU8ZAF+07pFTaJk/YAfFrT3bUB3vf9CGTyiPEe8xj5oMio9+4yf0v5FHyM3FFtKu8ewLUIhUwfvvBVTX3k+/50VPCwmwiJgODgjG+rbQjOyZZVgXLNUKV5L1h6N7D/5XlFG3w4desU4fn9Jw9KwMlKw/ueeg="

branches:
  except:
    - /.*-staging$/
    - /^staging-.*/

stages:
  - main

branches:
  except:
    - is-branch-info

jobs:
  fast_finish: true
  include:
    
    - language: python
      stage: main
      python: "3.8"
      before_install:
        - openssl aes-256-cbc -K $encrypted_cd0220f97c1a_key -iv $encrypted_cd0220f97c1a_iv -in gcloud-config.tar.gz.enc -out terra/gcloud-config.tar.gz -d
        - sudo apt-get update
        - sudo apt-get -y install openjdk-8-jre-headless
      install:
#        - pip3 -q install miniwdl
        - pip3 -q install firecloud
      script:
        - set -e
        - ./travis/test-wdl.sh
        - tar -xzf terra/gcloud-config.tar.gz -C $HOME
        - ./terra/terra_utils.py cmd_with_filename -f myfile.txt
        - ./terra/terra_utils.py deploy_to_terra


